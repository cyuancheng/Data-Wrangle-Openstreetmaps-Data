{"name":"Analyzing OpenStreetMap Data with MongoDB","tagline":"Chi-Yuan Cheng, Udacity Data Analyst Nanodegree","body":"##Project 2: Analyzing OpenStreetMap Data | Data Wrangling with MongoDB\r\n- Author:  Chi-Yuan Cheng (cyuancheng AT gmail DOT com) \r\n- Last updated: May 1th  2015\r\n\r\n###Map information:\r\n\r\n- Map Area: Santa Barbara County, CA, United States\r\n- The dataset can be found [here] (https://s3.amazonaws.com/metro-extracts.mapzen.com/santa-barbara_california.osm.bz2) \r\n- I choose Santa Barbara, CA because I have lived and worked there for 6 years.\r\n\r\n###Questions:\r\n\r\n####1. Problems encountered in your map\r\n\r\n- **Obtaining the OSM data:**\r\n\r\n I have a problem downloading the OSM file from the OpenStreetMap website. As suggesting by the project instruction, I downloaded the OSM file from Map Zen. \r\n- **Understanding data structure:** \r\n\r\n\tOne challenge was to understand the context and structure of the OSM data. We can use Python ElementTree to parse the data. We can also use UNIX \"grep\" comment to read the data. \r\n- **Loading json data into MongoDB:** \r\n\r\n\tI have a problem importing the json data into MongoDB using pymongo. I found it is faster and easier to import json data using \"mongoimport\", and query a collection in the mongo shell. \r\n\r\n- **Data cleaning:**\r\n\r\n\tSeveral street names have no street types and also some other errors. The uncorrected and corrected street names are in the \"changes\" and \"skip\" dictionaries in this [document] (http://nbviewer.ipython.org/github/cyuancheng/Data-Wrangle-Openstreetmaps-Data/blob/master/OpenstreetMapData-SB.ipynb). I manually changed these errors in \"shape_element\" function.  I also changed many similar street types to a non-abbreviated form after discovering these issues in the audit. The corrections are in this [document] (http://nbviewer.ipython.org/github/cyuancheng/Data-Wrangle-Openstreetmaps-Data/blob/master/OpenstreetMapData-SB.ipynb). \r\n\t\r\n\tAdditionally, I fount there are several inconsistent labeling elements of amenities when querying. For example, \"Starbucks\" vs \"Starbucks Coffee\" and \"In-N-Out\" vs \"In-N-Out Burger\". I corrected these inconsistent names using MongoDB, as following.\r\n\t\t\r\n\t```\r\n\t\tdb.sb.update({'name':\"Starbucks\"}, \r\n\t\t    {\"$set\":{\"name\" : \"Starbucks Coffee\"}},{multi:true})\r\n\t```\t\r\n\tbefore:   { \"_id\" : \"Starbucks Coffee\", \"count\" : 6 }\r\n\r\n\t after:     { \"_id\" : \"Starbucks Coffee\", \"count\" : 15 }\r\n\r\n####2. Overview of the data\r\n\r\n- File sizes:\r\n  \r\n          OSM file is about 175 MB  \r\n          JSON file is about 198 MB\r\n\r\n- Datasize:\r\n\r\n\t```\r\n\t> db.sb.dataSize()\r\n2066303408\r\n```\r\n\r\n- Number of document:\r\n  \r\n  ```\r\n  > db.sb.find().count()\r\n7424821\r\n``` \r\n \r\n- Number of node:\r\n\t\r\n\t```\r\n\t> db.sb.find({\"type\":\"node\"}).count()\r\n7136237\r\n```\r\n- Number of way:\r\n\r\n   ```\r\n   > db.sb.find({\"type\":\"way\"}).count()\r\n284368\r\n```\r\n- Number of created users\r\n\r\n ```\r\n > db.sb.distinct(\"created.user\").length\r\n438\r\n```\r\n- Number of cafes\r\n\r\n\t```\r\n\t> db.sb.find({\"amenity\":\"cafe\"}).count()\r\n\t350\r\n\t```\r\n- Number of shops \r\n\t\r\n\t```\r\n\t> db.sb.find({\"shop\":{$exists:1}}).count()\r\n2157\r\n\t```\r\n\r\n####3. Other ideas about the datasets\r\n\r\n- The top 5 contributed users\r\n\r\n\t```\r\n\t>db.sb.aggregate([\r\n            {'$match': {'created.user':{'$exists':1}}},\r\n            {'$group': {'_id':'$created.user',\r\n                        'count':{'$sum':1}}},\r\n            {'$sort': {'count':-1}},\r\n            {'$limit' : 5}])\r\n            \r\n\t{ \"_id\" : \"woodpeck_fixbot\", \"count\" : 2694493 }\r\n{ \"_id\" : \"nmixter\", \"count\" : 837826 }\r\n{ \"_id\" : \"Apo42\", \"count\" : 542586 }\r\n{ \"_id\" : \"Eureka gold\", \"count\" : 347793 }\r\n{ \"_id\" : \"USWilderness\", \"count\" : 331834 }\r\n```\r\n\r\n- The top 5 popular cuisines\r\n\r\n\t```\r\n\t> db.sb.aggregate( [\r\n            {'$match': {'amenity':'restaurant',\r\n                        'cuisine':{'$exists':1}}},\r\n            {\"$group\":{\"_id\":\"$cuisine\", \r\n                        \"count\":{\"$sum\":1}}},\r\n            {\"$sort\":{\"count\":-1}}, \r\n            {\"$limit\":5}])\r\n            \r\n\t{ \"_id\" : \"american\", \"count\" : 85 }\r\n{ \"_id\" : \"mexican\", \"count\" : 56 }\r\n{ \"_id\" : \"pizza\", \"count\" : 46 }\r\n{ \"_id\" : \"seafood\", \"count\" : 39 }\r\n{ \"_id\" : \"burger\", \"count\" : 37 }\r\n```\r\n\r\n- The top 5 popular schools\r\n\r\n\t```\r\n\t> db.sb.aggregate([\r\n            {\"$match\":{\"amenity\":\"school\",\r\n                       \"name\":{\"$exists\":1}}},\r\n            {\"$group\":{\"_id\":\"$name\", \r\n                        \"count\":{\"$sum\":1}}},\r\n            {\"$sort\":{\"count\":-1}}, \r\n            {\"$limit\":5}] )       \r\n                   \r\n\t{ \"_id\" : \"Lemonwood Elementary\", \"count\" : 32 }\r\n{ \"_id\" : \"Isla Vista Elementary School\", \"count\" : 22 }\r\n{ \"_id\" : \"Oxnard High School\", \"count\" : 16 }\r\n{ \"_id\" : \"Santa Barbara College\", \"count\" : 16 }\r\n{ \"_id\" : \"Wilson School\", \"count\" : 16 }\r\n\r\n\t```\r\n- The top 5 appearing amenities\r\n\r\n\t```\r\n\t> db.sb.aggregate([\r\n            {\"$match\":{\"amenity\":{\"$exists\":1}}}, \r\n            {\"$group\": {\"_id\":\"$amenity\",\r\n                        \"count\":{\"$sum\":1}}}, \r\n            {\"$sort\":{\"count\":-1}}, \r\n            {\"$limit\":5}])\r\n\r\n\t{ \"_id\" : \"parking\", \"count\" : 3071 }\r\n{ \"_id\" : \"school\", \"count\" : 2507 }\r\n{ \"_id\" : \"place_of_worship\", \"count\" : 2459 }\r\n{ \"_id\" : \"restaurant\", \"count\" : 856 }\r\n{ \"_id\" : \"telephone\", \"count\" : 760 }\r\n\t\r\n\t```\r\n\r\n\r\n- The top 5 popular fast food\r\n\r\n\t```\r\n\t> db.sb.aggregate([\r\n        {'$match': {'amenity':'fast_food',\r\n                    'name':{'$exists':1}}},\r\n        {\"$group\":{\"_id\":\"$name\", \r\n                    \"count\":{\"$sum\":1}}},\r\n        {\"$sort\":{\"count\":-1}}, \r\n        {\"$limit\":5}])\r\n        \r\n\t{ \"_id\" : \"McDonald's\", \"count\" : 70 }\r\n{ \"_id\" : \"Subway\", \"count\" : 56 }\r\n{ \"_id\" : \"Panda Express\", \"count\" : 39 }\r\n{ \"_id\" : \"Wendy's\", \"count\" : 31 }\r\n{ \"_id\" : \"Jack in the Box\", \"count\" : 24 }\r\n\t```\r\n- **Other Idea:**\r\n \t\r\n ***1. The most  populated district in Santa Barbara County***\r\n\t\r\n\tI want to know the most populated district in Santa Barbara County, so I did the following MongoDB query based on postcode.\r\n\t\r\n\t```\r\n\t> db.sb.aggregate( [\r\n  \t\t{ '$match' : { 'address.postcode' : {'$exists' : 1}}},\r\n        { '$project' : {'postcode' : \r\n        \t\t\t\t{ '$substr' : ['$address.postcode', 0, 5]}}}, \r\n       \t{ '$group' : {'_id' : '$postcode',  \r\n                \t 'count' : { '$sum' : 1 }}}, \r\n      \t{ '$sort' : {'count' : -1}},\r\n        \t\t\t{ '$limit' : 5} ] )\r\n        \t\t\t\r\n \t{ \"_id\" : \"93117\", \"count\" : 545 }\r\n{ \"_id\" : \"93436\", \"count\" : 428 }\r\n{ \"_id\" : \"93101\", \"count\" : 333 }\r\n{ \"_id\" : \"93001\", \"count\" : 207 }\r\n{ \"_id\" : \"93033\", \"count\" : 109 }\r\n\t```\r\n\tThe most populated district is 93117, which is Goleta city. I live in this area.\r\n\t\r\n\t\t\t\r\n\t***2. Wheelchair accessible amenities in Santa Barbara County.***\r\n\t\r\n\tI want to know which amenities are wheelchair accessible.\r\n\t\r\n\t```\r\n> db.sb.aggregate([\r\n        { '$match' :{'amenity' : {'$exists' : 1},\r\n                     'wheelchair' : 'yes'}},  \r\n        { '$group' : { '_id' :  '$amenity' ,                         \r\n                       'count' : { '$sum' : 1 }}}, \r\n        { '$sort' : {'count' : -1}},\r\n        {'$limit' : 5}])\r\n        \r\n\t{ \"_id\" : \"fast_food\", \"count\" : 24 }\r\n{ \"_id\" : \"toilets\", \"count\" : 16 }\r\n{ \"_id\" : \"fuel\", \"count\" : 16 }\r\n{ \"_id\" : \"hospital\", \"count\" : 16 }\r\n{ \"_id\" : \"restaurant\", \"count\" : 8 }\r\n\r\n\t```\r\nFast food is the most wheelchair accessible amenity in Santa Barbara. Next, we can find out which fast food provides wheelchair service.\r\n\r\n\t```\r\n> db.sb.aggregate([\r\n        { '$match' :{'amenity' : 'fast_food',\r\n                     'wheelchair' : 'yes'}},  \r\n        { '$group' : { '_id' :  '$name' ,                         \r\n                       'count' : { '$sum' : 1 }}}, \r\n        { '$sort' : {'count' : -1}},\r\n        {'$limit' : 5}]) \r\n        \r\n   { \"_id\" : \"In-N-Out Burger\", \"count\" : 16 }\r\n{ \"_id\" : \"McDonald's\", \"count\" : 8 }\r\n```\r\nInterestingly, only two fast food restaurants provide wheelchair service in Santa Barbara.\r\n\r\n\t***3. Find the closest hospital from my current location***\r\n\t\r\n\tThe greatest benefits of OSM data is for disaster preparedness and risk management. For example, OSM can help facilitate the delivery of goods and services in the Nepal earthquake disaster.  A recent [study](http://abc7.com/weather/simulation-shows-fallout-of-77-magnitude-quake-in-socal/684418/) suggests that Southern California may have a 7.7 magnitude earthquake in future, so we have to prepare.\r\n\t\r\n\tIn this regard, I used OSM to find the closest hospital from my current location in Santa Barbara area. The code can be find here ([ipynb] (http://nbviewer.ipython.org/github/cyuancheng/Data-Wrangle-Openstreetmaps-Data/blob/master/FindHospital.ipynb)). The map for hospitals are shown below (blue bubble: current position, red bubble: hospital).  \r\n\t\r\n![Alt text](https://raw.githubusercontent.com/cyuancheng/Data-Wrangle-Openstreetmaps-Data/master/cover_map.png)\r\n\r\n###Conclusion: \r\n\r\nThere are still many opportunities to clean and validate the OSM data in which I did not explore. It would be very helpful if we could update, validate, and/or pull missing information of the OSM data from other sources, such as Google Maps API. \r\n\r\n###Reference:\r\n1. https://docs.mongodb.org/manual/\r\n2. https://github.com/geopy/geopy\r\n3. http://wiki.openstreetmap.org/wiki/2015_Nepal_earthquake","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}